{% extends 'layout.html' %}

{% block content %}
<style type="text/css" >
    .wrap-loading div{ /*ë¡œë”© ì´ë¯¸ì§€*/
        position: fixed;
        top:50%;
        left:50%;
        margin-left: -21px;
        margin-top: -21px;
    }
    .display-none{ /*ê°ì¶”ê¸°*/
        display:none;
    }
</style>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-9" style="margin-left:50px;">
            <br><br>
            <h3><b>{{CompanyInfo.Name}} ê¸°ì—… ì •ë³´</b></h3><br>
            <br>
            <div class="row"  style="display:flex;">
                <div class="col-6">
                    <h4>ğŸ“—íšŒì‚¬ ì¸ì¬ìƒ</h4>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item">
                        {% for image in CompanyInfo.ImageQ %}
                            <button type="button" style="margin:2px" class="btn btn-outline-success" style="display: inline-block">{{image}}</button>
                        {% endfor %}
                        </li>
                    </ul>
                </div>
                <div class="col-6">
                    <h4>ğŸ“˜íšŒì‚¬ í•µì‹¬ê°€ì¹˜</h4>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item">
                        {% for value in CompanyInfo.Cvalue %}
                            <button type="button" style="margin:2px" class="btn btn-outline-primary" style="display: inline-block">{{value}}</button>
                        {% endfor %}
                        </li>
                    </ul>
                </div>
            </div>
            <hr width = "100%"><br>
            
            <h2><strong>ìì†Œì„œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</strong></h2>
            <form class="form-horizontal" method="post" action="/write">
                <fieldset>
                    <!-- <h5>ìì†Œì„œ ì œëª©: {{title}}</h5> -->
                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-md-12" for="question">Questions</label>
                        <div class="col-md-12">
                            <input id="question" name="question" type="text" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." class="form-control input-md", autofocus required><!--required : ê³µë°±ì…ë ¥ì‹œ ê²½ê³ -->
                        </div>
                    </div>
                    <!-- Textarea -->
                    <div class="form-group">
                        <label class="col-md-12" for="content">Contents</label>
                        <div class="col-md-12">
                            <textarea class="form-control" id="content" name="content" placeholder="ì§ˆë¬¸ì— ë§ëŠ” ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." style="height:260px;" required></textarea>
                        </div>
                    </div>

                    <ul class="list-group list-group-horizontal" >
                        <li style="display:none" id = "awkresult">ì–´ìƒ‰í•œ ë¬¸ì¥ ê²°ê³¼</li>
                        <li style="display:none" class="list-group-item" id="result"></li>
                    </ul>

                    <!-- Button 1 ì‘ì„± ì™„ë£Œí•˜ê¸° -->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="finishbutton"></label>
                        <div class="col-md-12">
                            <input id="finishbutton" name="finishbutton" class="btn btn-dark" type="submit" value="ì‘ì„± ì™„ë£Œí•˜ê¸°" onclick="location.href='{{ url_for('jasosul.jasoContent', ClusterId=ClusterId, title=title, username=username) }}'">
                        </div>
                    </div>

                    <!-- Button 2 ê³„ì† ì§ˆë¬¸ ì¶”ê°€í•˜ê¸°-->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="continuebutton"></label>
                        <div class="col-md-12">
                            <input id="continuebutton" name="continuebutton" class="btn btn-info" type="button" value="ê³„ì†í•˜ê¸°" onclick="saveSubContent({{ClusterId}})">
                        </div>
                    </div>

                    <!-- Button 3 ì–´ìƒ‰í•œ ë¬¸ì¥ ì°¾ê¸° -->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="ackwardbutton"></label>
                        <div class="col-md-12">
                            <input id="ackwardbutton" name="ackwardbutton" class="btn btn-danger" type="button" value="ì–´ìƒ‰í•œ ë¬¸ì¥" onclick="sendContent()">
                        </div>
                    </div>

                    <!-- Button 4 ì–´ìƒ‰í•œ ë¬¸ì¥ í•˜ì´ë¼ì´íŠ¸ í•´ì œ -->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="noackwardbutton"></label>
                        <div class="col-md-12">
                            <input id="noackwardbutton" name="noackwardbutton" class="btn btn-secondary" type="button" value="ì–´ìƒ‰í•œ ë¬¸ì¥ ì•ˆë³´ì´ê²Œ" >
                        </div>
                    </div>


                </fieldset>
            </form>
            
            <br>
            <hr width = "100%"><br>
            
            <label class="col-md-12" for="DragPlace">ì„ íƒí•œ ë¬¸ì¥(ë“œë˜ê·¸í•´ì„œ ë¬¸ì¥ ì„ íƒ) </label>
            <input id="DragTEXT" name="DragTEXT" type="text" style="display: inline-block" class="form-control col-sm-10"></input>
            
                <!-- ë¬¸ì¥ ì¶”ì²œ Button -->
                <span> 
                    <button type="button" id="recommendbutton" name="recommendbutton" style="float:right" class="btn btn-warning" onclick="sendSentence()">ë‹¤ìŒ ë¬¸ì¥ ì¶”ì²œ</button>
                </span>

                <!-- loading ìœ„ì¹˜ -->
                <div class="wrap-loading display-none">
                    <div><img src="{{ url_for('static', filename='profile_imgs/loading.gif')}}" /></div>
                </div>

                <!-- ë¬¸ì¥ ì¶”ì²œ ê²°ê³¼-->
                <ul class="list-group" id="recommendResult" name="recommendResult">
                </ul>
            <br><br>
            <hr width = "100%" style="border: solid 2px"><br>
            
            <button type="button" id="displayCompany" name="displayCompany" style=" align-items: center;" class="btn btn-primary btn-lg" onclick="display()">íšŒì¬ ì¸ì¬ìƒ í™•ì¸í•˜ê¸°</button>
            <div id="showCompany" style="display:none">
                <!-- í•´ë‹¹ íšŒì‚¬ ìì†Œì„œ ë³´ì—¬ì£¼ê¸°-->
                <h1 align="center"> <strong>{{companyName}}ì˜ ì£¼ìš” í‚¤ì›Œë“œ</strong></h1><br>
                <hr width = "100%"><br>
                <div class="col-md-12">
                    <div style = "height:70% ; width:100% text-align:center;">
                        <img src="{{ url_for('static', filename='company_keywords/Pie/'+companyName+'_Pie.png')}}" width="100%", height="70%">
                    </div>
                    <div style = "height:100% ; width:100% text-align:center;">
                        <img src="{{ url_for('static', filename='company_keywords/Treemap/'+companyName+'_Treemap.png')}}"width="100%", height="70%">
                    </div>
                    <div style = "height:100% ; width:100% text-align:center;">
                        <img src="{{ url_for('static', filename='company_keywords/WordCloud/'+companyName+'_KeyWord.png')}}" width="100%", height="70%">
                    </div>
                    <br>
                </div>
            </div>
            <br><br><br>
        </div>
        <!--ìœ ì‚¬ ë‹¨ì–´-->
        <div class="col-md-2" style="margin-top: 350px; margin-bottom: 200px; ">
            <span><b>ìœ ì‚¬ ë‹¨ì–´ ê²€ìƒ‰</b></span> 
            <div class="row">
                <span class=" col-sm-7">
                    <input type="text" id="searchWord" name="searchWord" style="display: inline-block" class="form-control" placeholder="ë‹¨ì–´" required autofocus> 
                </span>
                <span class="col">
                    <input id="searchButton" name="searchButton"  class="btn btn-secondary" type="submit" onclick="sendWord()" value=" ê²€  ìƒ‰ ">
                </span>
            </div>
            <br>
            <div id="wordResult" style="background-color:#FAFAD2; text-align:center; padding:10px; display:none; " >
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    function display(){
        if($('#showCompany').css('display') == 'none'){
        $('#showCompany').show();
        }else{
            $('#showCompany').hide();
        }
    }
</script>

<script>
    $('#noackwardbutton').click(function() {
        $("#result").hide();
        $("#awkresult").hide();
    })
    
    $('#ackwardbutton').click(function() {
        $("#result").show();
        $("#awkresult").show();
    })
</script>

<script type="text/javascript">
    function selectText() {
        var selectionText = "";
        if (document.getSelection) {
            selectionText = document.getSelection();
        } else if (document.selection) {
            selectionText = document.selection.createRange().text;
        }
        return selectionText;
    }
   
    document.onmouseup = function() {
        document.getElementById("DragTEXT").value = selectText();
    }
</script>

<script>
    function sendSentence(){ //ë¬¸ì¥ ë³´ë‚´ê¸° => ë¬¸ì¥ ì¶”ì²œ
        var recommendText=$('#DragTEXT').val(); //ì…ë ¥ë¬¸ì¥

        var postdata = {
            'recommendText': recommendText
        }

        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.jasoRecommend")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                var recommendResults = data.recommendResults;
                if ($('#recommendResult').length) {
                    $("#recommendResult").empty();
                }

                if ($('#recommendResult').length) {
                    $("#recommendResult").empty();
                }
                
                var resultString = "<br>";
                
                resultString += "<h5><strong>ë¬¸ì¥ ì¶”ì²œ ê²°ê³¼</strong></h5>"
                $.each(recommendResults, function(i){
                    resultString += '<li class="list-group-item">'+String(i+1)+". "+recommendResults[i]+'</li>'
                });

                $("#recommendResult").append(resultString);

            },
            beforeSend:function(){
                $('.wrap-loading').removeClass('display-none');
            },
            complete:function(){
                $('.wrap-loading').addClass('display-none');
            },
            error: function(request, status, error){
                alert('ajax í†µì‹  ì‹¤íŒ¨')
                alert(error);
            }
        })
    }

    function sendContent(){ //ë¬¸ë‹¨ ë³´ë‚´ê¸° => ì–´ìƒ‰í•œ ë¬¸ì¥
        var content=$('#content').val(); //ì§ˆë¬¸
        
        var postdata = {
            'AwkContent':content
        }
        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.jasoAwkFind")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                var awkResults = data.awkResults;

                var resultString="<p>";
                $.each(awkResults, function(i){
                    if (awkResults[i][0] == 1) {//strong
                        resultString += "<mark style=\"background-color:#F6A9A9;\">"+awkResults[i][1]+"</mark>";
                    }
                    else if(awkResults[i][0] == 2){//weak
                        resultString += "<mark style=\"background-color:#FFE3E3;\">"+awkResults[i][1]+"</mark>";
                    }
                    else{
                        resultString +=awkResults[i][1]
                    }
                });
                resultString+="</p>";

                var blk=document.getElementById("result");
                blk.innerHTML=resultString;

            },
            error: function(request, status, error){
                alert('ajax í†µì‹  ì‹¤íŒ¨')
                alert(error);
            }
        })
    }

    //ì¤‘ê°„ ì €ì¥í•˜ê¸° + ìµœì¢… ì €ì¥í•˜ê¸°
    function saveSubContent(ClusterId){
        var question=$('#question').val(); //ì§ˆë¬¸
        var content=$('#content').val(); //ë¬¸ì¥

        var postdata = {
            'ClusterId' : ClusterId,
            'question' : question,
            'content' : content
        }

        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.jasoWrite")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                $('#question').val('');
                $('#content').val('');
                $('#DragTEXT').val('');
            },
            error: function(request, status, error){
                alert('ajax í†µì‹  ì‹¤íŒ¨')
                alert(error);
            }
        })
    }
</script>

<script>
    function sendWord(){ //ë‹¨ì–´ ë³´ë‚´ê¸°
        var recommendWord=$('#searchWord').val(); //ì…ë ¥ë‹¨ì–´

        var postdata = {
            'recommendWord': recommendWord
        }

        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.WordRecommend")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                
                var wordList=data.wordReList;
                var wordString="<div style=\"text-align:center;\ color:grey;\">";
        
                for(var i=0;i<wordList.length;i++){
                    wordString+=wordList[i]+"<br>";
                }
                wordString+="</div>";

                var blk=document.getElementById("wordResult");
                blk.innerHTML=wordString;

            },
            error: function(request, status, error){
                alert('ajax í†µì‹  ì‹¤íŒ¨')
                alert(error);
            }
        })
    }

    $('#searchButton').click(function() {
    $("#wordResult").show(); 
}) 
</script>
{% endblock %}