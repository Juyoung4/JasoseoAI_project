{% extends 'layout.html' %}

{% block content %}
<style>
    #loading-mask {
        position: absolute;
        top:655px;
        left:120px;
        opacity: 0.80;
        filter: alpha(opacity=80);
        z-index: 30000;
        height: 100px;
        width:100px;
        display: none;
        background: url(C:\Users\msi\GitHub\JasoseoAI_project\5.web\re-ai\flaskr\static\profile_imgs\loading2.gif);
        background-size: 70;
        background-color: red;
  }
</style>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-9" style="margin-left:50px;">
            <br><br>
            <h3><b>{{CompanyInfo.Name}} Í∏∞ÏóÖ Ï†ïÎ≥¥</b></h3><br>
            <br>
            <div class="row"  style="display:flex;">
                <div class="col-6">
                    <h4>üìóÌöåÏÇ¨ Ïù∏Ïû¨ÏÉÅ</h4>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item">
                        {% for image in CompanyInfo.ImageQ %}
                            <button type="button" style="margin:2px" class="btn btn-outline-success" style="display: inline-block">{{image}}</button>
                        {% endfor %}
                        </li>
                    </ul>
                </div>
                <div class="col-6">
                    <h4>üìòÌöåÏÇ¨ ÌïµÏã¨Í∞ÄÏπò</h4>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item">
                        {% for value in CompanyInfo.Cvalue %}
                            <button type="button" style="margin:2px" class="btn btn-outline-primary" style="display: inline-block">{{value}}</button>
                        {% endfor %}
                        </li>
                    </ul>
                </div>
            </div>
            <hr width = "100%"><br>
            
            <h2><strong>ÏûêÏÜåÏÑúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</strong></h2>
            <form class="form-horizontal" method="post" action="/write">
                <fieldset>
                    <!-- <h5>ÏûêÏÜåÏÑú Ï†úÎ™©: {{title}}</h5> -->
                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-md-12" for="question">Questions</label>
                        <div class="col-md-12">
                            <input id="question" name="question" type="text" placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî." class="form-control input-md", autofocus required><!--required : Í≥µÎ∞±ÏûÖÎ†•Ïãú Í≤ΩÍ≥†-->
                        </div>
                    </div>
                    <!-- Textarea -->
                    <div class="form-group">
                        <label class="col-md-12" for="content">Contents</label>
                        <div class="col-md-12">
                            <textarea class="form-control" id="content" name="content" placeholder="ÏßàÎ¨∏Ïóê ÎßûÎäî ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî." style="height:260px;" required></textarea>
                        </div>
                    </div>

                    <ul class="list-group list-group-horizontal" >
                        <li style="display:none" id = "awkresult">Ïñ¥ÏÉâÌïú Î¨∏Ïû• Í≤∞Í≥º</li>
                        <li style="display:none" class="list-group-item" id="result"></li>
                    </ul>

                    <!-- Button 1 ÏûëÏÑ± ÏôÑÎ£åÌïòÍ∏∞ -->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="finishbutton"></label>
                        <div class="col-md-12">
                            <input id="finishbutton" name="finishbutton" class="btn btn-dark" type="submit" value="ÏûëÏÑ± ÏôÑÎ£åÌïòÍ∏∞" onclick="location.href='{{ url_for('jasosul.jasoContent', ClusterId=ClusterId, title=title, username=username) }}'">
                        </div>
                    </div>

                    <!-- Button 2 Í≥ÑÏÜç ÏßàÎ¨∏ Ï∂îÍ∞ÄÌïòÍ∏∞-->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="continuebutton"></label>
                        <div class="col-md-12">
                            <input id="continuebutton" name="continuebutton" class="btn btn-info" type="button" value="Í≥ÑÏÜçÌïòÍ∏∞" onclick="saveSubContent({{ClusterId}})">
                        </div>
                    </div>

                    <!-- Button 3 Ïñ¥ÏÉâÌïú Î¨∏Ïû• Ï∞æÍ∏∞ -->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="ackwardbutton"></label>
                        <div class="col-md-12">
                            <input id="ackwardbutton" name="ackwardbutton" class="btn btn-danger" type="button" value="Ïñ¥ÏÉâÌïú Î¨∏Ïû•" onclick="sendContent()">
                        </div>
                    </div>

                    <!-- Button 4 Ïñ¥ÏÉâÌïú Î¨∏Ïû• ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìï¥Ï†ú -->
                    <div class="form-group" style="float: right;">
                        <label class="col-md-12 control-label" for="noackwardbutton"></label>
                        <div class="col-md-12">
                            <input id="noackwardbutton" name="noackwardbutton" class="btn btn-secondary" type="button" value="Ïñ¥ÏÉâÌïú Î¨∏Ïû• ÏïàÎ≥¥Ïù¥Í≤å" >
                        </div>
                    </div>


                </fieldset>
            </form>
            
            <br>
            <hr width = "100%"><br>
            
            <label class="col-md-12" for="DragPlace">ÏÑ†ÌÉùÌïú Î¨∏Ïû•(ÎìúÎûòÍ∑∏Ìï¥ÏÑú Î¨∏Ïû• ÏÑ†ÌÉù) </label>
            <input id="DragTEXT" name="DragTEXT" type="text" style="display: inline-block" class="form-control col-sm-10"></input>
            
                <!-- Î¨∏Ïû• Ï∂îÏ≤ú Button -->
                <span> 
                    <button type="button" id="recommendbutton" name="recommendbutton" style="float:right" class="btn btn-warning" onclick="sendSentence()">Îã§Ïùå Î¨∏Ïû• Ï∂îÏ≤ú</button>
                </span>

                <div class="col-md-12" id="loading-mask"></div>

                <!-- Î¨∏Ïû• Ï∂îÏ≤ú Í≤∞Í≥º-->
                <ul class="list-group" id="recommendResult" name="recommendResult">
                </ul>
            <br><br>
            <hr width = "100%" style="border: solid 2px"><br>
            
            <button type="button" id="displayCompany" name="displayCompany" style=" align-items: center;" class="btn btn-primary btn-lg" onclick="display()">ÌöåÏû¨ Ïù∏Ïû¨ÏÉÅ ÌôïÏù∏ÌïòÍ∏∞</button>
            <div id="showCompany" style="display:none">
                <!-- Ìï¥Îãπ ÌöåÏÇ¨ ÏûêÏÜåÏÑú Î≥¥Ïó¨Ï£ºÍ∏∞-->
                <h1 align="center"> <strong>{{companyName}}Ïùò Ï£ºÏöî ÌÇ§ÏõåÎìú</strong></h1><br>
                <hr width = "100%"><br>
                <div class="col-md-12">
                    <div style = "height:70% ; width:100% text-align:center;">
                        <img src="{{ url_for('static', filename='company_keywords/Pie/'+companyName+'_Pie.png')}}" width="100%", height="70%">
                    </div>
                    <div style = "height:100% ; width:100% text-align:center;">
                        <img src="{{ url_for('static', filename='company_keywords/Treemap/'+companyName+'_Treemap.png')}}"width="100%", height="70%">
                    </div>
                    <div style = "height:100% ; width:100% text-align:center;">
                        <img src="{{ url_for('static', filename='company_keywords/WordCloud/'+companyName+'_KeyWord.png')}}" width="100%", height="70%">
                    </div>
                    <br>
                </div>
            </div>
            <br><br><br>
        </div>
        <!--Ïú†ÏÇ¨ Îã®Ïñ¥-->
        <div class="col-md-2" style="margin-top: 350px; margin-bottom: 200px; ">
            <span><b>Ïú†ÏÇ¨ Îã®Ïñ¥ Í≤ÄÏÉâ</b></span> 
            <div class="row">
                <span class=" col-sm-7">
                    <input type="text" id="searchWord" name="searchWord" style="display: inline-block" class="form-control" placeholder="Îã®Ïñ¥" required autofocus> 
                </span>
                <span class="col">
                    <input id="searchButton" name="searchButton"  class="btn btn-secondary" type="submit" onclick="sendWord()" value=" Í≤Ä  ÏÉâ ">
                </span>
            </div>
            <br>
            <div id="wordResult" style="background-color:#FAFAD2; text-align:center; padding:10px; display:none; " >
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    function display(){
        if($('#showCompany').css('display') == 'none'){
        $('#showCompany').show();
        }else{
            $('#showCompany').hide();
        }
    }
</script>

<script>
    $('#noackwardbutton').click(function() {
        $("#result").hide();
        $("#awkresult").hide();
    })
    
    $('#ackwardbutton').click(function() {
        $("#result").show();
        $("#awkresult").show();
    })
</script>

<script type="text/javascript">
    function selectText() {
        var selectionText = "";
        if (document.getSelection) {
            selectionText = document.getSelection();
        } else if (document.selection) {
            selectionText = document.selection.createRange().text;
        }
        return selectionText;
    }
   
    document.onmouseup = function() {
        document.getElementById("DragTEXT").value = selectText();
    }
</script>

<script>
    function sendSentence(){ //Î¨∏Ïû• Î≥¥ÎÇ¥Í∏∞ => Î¨∏Ïû• Ï∂îÏ≤ú
        var recommendText=$('#DragTEXT').val(); //ÏûÖÎ†•Î¨∏Ïû•

        var postdata = {
            'recommendText': recommendText
        }

        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.jasoRecommend")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                var recommendResults = data.recommendResults;
                if ($('#recommendResult').length) {
                    $("#recommendResult").empty();
                }

                if ($('#recommendResult').length) {
                    $("#recommendResult").empty();
                }
                
                var resultString = "<br>";
                
                resultString += "<h5><strong>Î¨∏Ïû• Ï∂îÏ≤ú Í≤∞Í≥º</strong></h5>"
                $.each(recommendResults, function(i){
                    resultString += '<li class="list-group-item">'+String(i+1)+". "+recommendResults[i]+'</li>'
                });

                $("#recommendResult").append(resultString);

            },
            error: function(request, status, error){
                alert('ajax ÌÜµÏã† Ïã§Ìå®')
                alert(error);
            }
        })
    }

    function sendContent(){ //Î¨∏Îã® Î≥¥ÎÇ¥Í∏∞ => Ïñ¥ÏÉâÌïú Î¨∏Ïû•
        var content=$('#content').val(); //ÏßàÎ¨∏
        
        var postdata = {
            'AwkContent':content
        }
        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.jasoAwkFind")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                var awkResults = data.awkResults;

                var resultString="<p>";
                $.each(awkResults, function(i){
                    if (awkResults[i][0] == 1) {//strong
                        resultString += "<mark style=\"background-color:#F6A9A9;\">"+awkResults[i][1]+"</mark>";
                    }
                    else if(awkResults[i][0] == 2){//weak
                        resultString += "<mark style=\"background-color:#FFE3E3;\">"+awkResults[i][1]+"</mark>";
                    }
                    else{
                        resultString +=awkResults[i][1]
                    }
                });
                resultString+="</p>";

                var blk=document.getElementById("result");
                blk.innerHTML=resultString;

            },
            beforeSend:function(){
                jQuery("#loading-mask").show();
            },
            complete:function(){
                jQuery("#loading-mask").fadeOut();
            },
            error: function(request, status, error){
                alert('ajax ÌÜµÏã† Ïã§Ìå®')
                alert(error);
            }
        })
    }

    //Ï§ëÍ∞Ñ Ï†ÄÏû•ÌïòÍ∏∞ + ÏµúÏ¢Ö Ï†ÄÏû•ÌïòÍ∏∞
    function saveSubContent(ClusterId){
        var question=$('#question').val(); //ÏßàÎ¨∏
        var content=$('#content').val(); //Î¨∏Ïû•

        var postdata = {
            'ClusterId' : ClusterId,
            'question' : question,
            'content' : content
        }

        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.jasoWrite")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                $('#question').val('');
                $('#content').val('');
                $('#DragTEXT').val('');
            },
            error: function(request, status, error){
                alert('ajax ÌÜµÏã† Ïã§Ìå®')
                alert(error);
            }
        })
    }
</script>

<script>
    function sendWord(){ //Îã®Ïñ¥ Î≥¥ÎÇ¥Í∏∞
        var recommendWord=$('#searchWord').val(); //ÏûÖÎ†•Îã®Ïñ¥

        var postdata = {
            'recommendWord': recommendWord
        }

        $.ajax({
            type: 'POST',
            url: '{{url_for("jasosul.WordRecommend")}}',
            data: JSON.stringify(postdata),
            dataType : 'JSON',
            contentType: "application/json",
            success: function(data){
                
                var wordList=data.wordReList;
                var wordString="<div style=\"text-align:center;\ color:grey;\">";
        
                for(var i=0;i<wordList.length;i++){
                    wordString+=wordList[i]+"<br>";
                }
                wordString+="</div>";

                var blk=document.getElementById("wordResult");
                blk.innerHTML=wordString;

            },
            error: function(request, status, error){
                alert('ajax ÌÜµÏã† Ïã§Ìå®')
                alert(error);
            }
        })
    }

    $('#searchButton').click(function() {
    $("#wordResult").show(); 
}) 
</script>
{% endblock %}